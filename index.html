<script>
  document.addEventListener('DOMContentLoaded', () => {
    // === ВАЖНО: Отправляем событие инициализации ===
    if (window.VK && window.VK.call) {
      // Для старого SDK (mini_apps_sdk.js)
      VK.call('init');
    } else if (window.VKBridge) {
      // Для нового VK Bridge (современный способ)
      VKBridge.send("VKWebAppInit");
    }

    // === Дальше ваш код калькулятора ===
    const formScreen = document.getElementById('formScreen');
    const resultScreen = document.getElementById('resultScreen');
    const calcForm = document.getElementById('calcForm');
    const paymentOutput = document.getElementById('payment');
    const backBtn = document.getElementById('backBtn');

    function calculatePayment(amount, months) {
      return (amount / months).toFixed(2);
    }

    calcForm.onsubmit = (e) => {
      e.preventDefault();
      
      const amount = parseFloat(document.getElementById('amount').value);
      const months = parseInt(document.getElementById('months').value);

      if (amount <= 0 || months <= 0) {
        alert("Введите корректные значения!");
        return;
      }

      const payment = calculatePayment(amount, months);
      paymentOutput.textContent = payment;

      formScreen.style.display = 'none';
      resultScreen.style.display = 'block';

      // Можно отправить событие, что расчёт завершён (опционально)
      if (window.VKBridge) {
        VKBridge.send("VKWebAppTapticImpactOccurred", { style: "medium" });
      }
    };

    backBtn.onclick = () => {
      formScreen.style.display = 'block';
      resultScreen.style.display = 'none';
      calcForm.reset();
    };

    // (Опционально) Подписка на события от VK
    if (window.VKBridge) {
      VKBridge.subscribe((event) => {
        console.log('VK Event:', event);
      });
    }
  });
</script>
